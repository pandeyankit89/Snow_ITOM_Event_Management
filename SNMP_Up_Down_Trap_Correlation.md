## Service-now ITOM Event Management 
---
### How to close and Alert generated by 'Down' SNMP Trap with and 'UP' SNMP Traps ?

### Requirement :
Need to claer alert generated by Palo-Alto SNMP Trap `panVPNTunnelStatusDownTrap` with `panVPNTunnelStatusUpTrap` from same Node.

- Traps Description are like -
```javascript
int_ev_type = SNMP , panActionflags = 0x8000000000000000 , panEventSubType = vpn , panEventType = SYSTEM , panHostname = MY-VPN-HOSTNAME ,
panReceiveTime = 2025/06/18 05:24:03 , panSeqno = 7494862096395057849 , panSerial = 016401004888 , panSystemDescription = Tunnel AWS_TUNNEL_EXT_Peer_1:ID_1 is down ,
panSystemEventId = tunnel-status-down , panSystemModule = general , panSystemObject = AWS_TUNNEL_EXT_Peer_1:ID_1 , panSystemSeverity = 5 , panVsys = ,
snmpTrapOID = iso.org.dod.internet.private.enterprises.panRoot.panMibs.panCommonMib.panCommonEvents.panCommonEventEvents.panCommonEventEventsV2.panVPNTunnelStatusDownTrap ,
sysUpTime = 60 days, 8:53:02.64
```
```javascript
int_ev_type = SNMP , panActionflags = 0x8000000000000000 , panEventSubType = vpn , panEventType = SYSTEM , panHostname = MY-VPN-HOSTNAM ,
panReceiveTime = 2025/06/18 05:24:34 , panSeqno = 7494862096395057874 , panSerial = 016401004888 , panSystemDescription = Tunnel AWS_TUNNEL_EXT_Peer_1:ID_1 is up ,
panSystemEventId = tunnel-status-up , panSystemModule = general , panSystemObject = AWS_TUNNEL_EXT_Peer_1:ID_1 , panSystemSeverity = 5 , panVsys = ,
snmpTrapOID = iso.org.dod.internet.private.enterprises.panRoot.panMibs.panCommonMib.panCommonEvents.panCommonEventEvents.panCommonEventEventsV2.panVPNTunnelStatusUpTrap ,
sysUpTime = 60 days, 8:53:34.04
```

### Solution :
- (1) Create an Event-Rule with Lower Order say 90.
  
- (2) Create Event-Filter, so this rule can only process if `snmpTrapOID` contains `panVPNTunnelStatusDownTrap` or `panVPNTunnelStatusUpTrap`

- (3) Create an `Expression` for field `snmpTrapOID` with two fields (1) AlertGroup and (2) AlertStatus- 
```javascript
iso.org.dod.internet.private.enterprises.panRoot.panMibs.panCommonMib.panCommonEvents.panCommonEventEvents.panCommonEventEventsV2.(panVPNTunnelStatus|.*)(DownTrap|UpTrap|$)
```

- (4) Create `Message-Key` as `${panHostname}-${AlertGroup}`. Now, it will have same message-key for Down and Up traps like `hostname-panVPNTunnelStatus`, so both can correlate.
  
- (5) Make sure `Severity` is set as `${severity}`
  
- (6) Create an `Event Field Mapping` for this `Source`, where `Mapping Type` is `Map field and transform value (Single field)`. 
	- select `Source field` as `panSystemEventId` and `target field` as `severity`
	- Enter `tunnel-status-up` in `From value` and `0` into `To value`
	- Enter `tunnel-status-down` in `From value` and `4` into `To value`
---
